import{SvelteElement,action_destroyer,append,assign,attr,attribute_to_object,binding_callbacks,destroy_each,detach,element,empty,flush,get_spread_update,init,insert,is_function,listen,noop,not_equal,run_all,set_custom_element_data,set_data,set_dynamic_element_data,set_style,space,text,toggle_class}from"../../../packages/svelte/internal/index.mjs";import"../../../packages/joi-browser.min.js";import{onDestroy}from"../../../packages/svelte/internal/index.mjs";import"../item/index.js";import{createValidator}from"../../../lib/validation.js";import{onLongTouch}from"../../../lib/events.js";import{getActionTag,isLink,dispatchContentDisplayEvent}from"../../../lib/item.js";function get_each_context(e,t,i){const o=e.slice();return o[20]=t[i],o}function create_if_block(e){let t,i=e[1],o=[];for(let t=0;t<i.length;t+=1)o[t]=create_each_block(get_each_context(e,i,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=empty()},m(e,i){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,i);insert(e,t,i)},p(e,a){if(262&a){let r;for(i=e[1],r=0;r<i.length;r+=1){const n=get_each_context(e,i,r);o[r]?o[r].p(n,a):(o[r]=create_each_block(n),o[r].c(),o[r].m(t.parentNode,t))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(e){destroy_each(o,e),e&&detach(t)}}}function create_dynamic_element(e){let t,i,o,a,r,n,l,s,c=[{href:n=isLink(e[20])?e[20].url:void 0},{rel:"noopener"},{target:"_blank"}],d={};for(let e=0;e<c.length;e+=1)d=assign(d,c[e]);return{c(){t=element(getActionTag(e[20])),i=element("hdl-dashboard-item"),set_custom_element_data(i,"title",o=e[20].title),set_custom_element_data(i,"icon",a=e[20].icon),set_custom_element_data(i,"iconalt",r=e[2]?.iconalt),set_dynamic_element_data(getActionTag(e[20]))(t,d)},m(o,a){insert(o,t,a),append(t,i),l||(s=listen(t,"click",(function(){is_function(isLink(e[20])?void 0:e[8](e[20]))&&(isLink(e[20])?void 0:e[8](e[20])).apply(this,arguments)})),l=!0)},p(l,s){e=l,2&s&&o!==(o=e[20].title)&&set_custom_element_data(i,"title",o),2&s&&a!==(a=e[20].icon)&&set_custom_element_data(i,"icon",a),4&s&&r!==(r=e[2]?.iconalt)&&set_custom_element_data(i,"iconalt",r),set_dynamic_element_data(getActionTag(e[20]))(t,d=get_spread_update(c,[2&s&&n!==(n=isLink(e[20])?e[20].url:void 0)&&{href:n},{rel:"noopener"},{target:"_blank"}]))},d(e){e&&detach(t),l=!1,s()}}}function create_each_block(e){let t,i,o=getActionTag(e[20]),a=getActionTag(e[20])&&create_dynamic_element(e);return{c(){t=element("li"),a&&a.c(),i=space(),attr(t,"class","animated hover-fx")},m(e,o){insert(e,t,o),a&&a.m(t,null),append(t,i)},p(e,r){getActionTag(e[20])?o?not_equal(o,getActionTag(e[20]))?(a.d(1),a=create_dynamic_element(e),o=getActionTag(e[20]),a.c(),a.m(t,i)):a.p(e,r):(a=create_dynamic_element(e),o=getActionTag(e[20]),a.c(),a.m(t,i)):o&&(a.d(1),a=null,o=getActionTag(e[20]))},d(e){e&&detach(t),a&&a.d(e)}}}function create_fragment(e){let t,i,o,a,r,n,l,s,c,d,g,m,u,p,b,h,v,f,_,x,y,k,w,T,$,j=e[1]?.length>0&&create_if_block(e);return{c(){t=element("ul"),i=element("li"),o=element("h2"),a=element("span"),r=text(e[0]),n=space(),l=element("div"),s=element("button"),d=space(),g=element("button"),u=space(),p=element("button"),b=element("div"),h=element("button"),f=space(),_=element("button"),k=space(),j&&j.c(),this.c=noop,attr(s,"title",c=e[2]?.expandTitle),attr(s,"class","expand animated hover-fx not-visible"),toggle_class(s,"visible",e[5]),attr(g,"title",m=e[2]?.editTitle),attr(g,"class","edit animated hover-fx not-visible"),toggle_class(g,"visible",e[5]),attr(h,"class","confirm animated hover-fx"),attr(h,"title",v=e[2]?.confirmTitle),attr(_,"class","abort animated hover-fx"),attr(_,"title",x=e[2]?.abortTitle),attr(b,"class","confirmPanel animated not-visible"),toggle_class(b,"visible",e[6]),attr(p,"title",y=e[2]?.deletetitle),attr(p,"class","delete animated not-visible"),toggle_class(p,"visible",e[5]),toggle_class(p,"hover-fx",!e[6]),attr(l,"class","controls"),attr(t,"class","animated"),toggle_class(t,"overflowed",e[7]),toggle_class(t,"marked-for-control",e[5]),set_style(t,"--max-visible",e[3])},m(c,m){insert(c,t,m),append(t,i),append(i,o),append(o,a),append(a,r),append(i,n),append(i,l),append(l,s),append(l,d),append(l,g),append(l,u),append(l,p),append(p,b),append(b,h),append(b,f),append(b,_),append(t,k),j&&j.m(t,null),e[16](t),T||($=[listen(s,"click",e[11]),listen(g,"click",e[12]),listen(h,"click",e[13]),listen(_,"click",e[14]),listen(p,"click",e[10]),action_destroyer(w=onLongTouch.call(null,t,e[9]))],T=!0)},p(e,[i]){1&i&&set_data(r,e[0]),4&i&&c!==(c=e[2]?.expandTitle)&&attr(s,"title",c),32&i&&toggle_class(s,"visible",e[5]),4&i&&m!==(m=e[2]?.editTitle)&&attr(g,"title",m),32&i&&toggle_class(g,"visible",e[5]),4&i&&v!==(v=e[2]?.confirmTitle)&&attr(h,"title",v),4&i&&x!==(x=e[2]?.abortTitle)&&attr(_,"title",x),64&i&&toggle_class(b,"visible",e[6]),4&i&&y!==(y=e[2]?.deletetitle)&&attr(p,"title",y),32&i&&toggle_class(p,"visible",e[5]),64&i&&toggle_class(p,"hover-fx",!e[6]),e[1]?.length>0?j?j.p(e,i):(j=create_if_block(e),j.c(),j.m(t,null)):j&&(j.d(1),j=null),128&i&&toggle_class(t,"overflowed",e[7]),32&i&&toggle_class(t,"marked-for-control",e[5]),8&i&&set_style(t,"--max-visible",e[3])},i:noop,o:noop,d(i){i&&detach(t),j&&j.d(),e[16](null),T=!1,run_all($)}}}function instance(e,t,i){let o,a,{title:r}=t,{items:n}=t,{messages:l}=t,{maxvisible:s}=t,c=!1,d=!1;const g={deleteTimeoutId:void 0,confirmTimeoutId:void 0},{joi:m}=window,u=createValidator("dashboard/widget");function p(){clearTimeout(g.deleteTimeoutId),i(5,c=!0),g.deleteTimeoutId=setTimeout((()=>{i(5,c=!1)}),3e3)}return onDestroy((()=>{clearTimeout(g.deleteTimeoutId),clearTimeout(g.confirmTimeoutId)})),e.$$set=e=>{"title"in e&&i(0,r=e.title),"items"in e&&i(1,n=e.items),"messages"in e&&i(2,l=e.messages),"maxvisible"in e&&i(3,s=e.maxvisible)},e.$$.update=()=>{1&e.$$.dirty&&u(r,"title",m.string()),2&e.$$.dirty&&u(n,"items",m.array().items(m.object({$id:m.string().required(),title:m.string().required(),url:m.string(),snapshot:m.alternatives().try(m.string(),null),icon:m.alternatives().try(m.string(),null),type:m.string().valid("url","text","javascript","css","html","shell","python","json")}).unknown().required()).min(1)),4&e.$$.dirty&&u(l,"messages",m.object({iconalt:m.string().required(),deletetitle:m.string().required(),editTitle:m.string().required(),confirmTitle:m.string().required(),abortTitle:m.string().required(),expandTitle:m.string().required()})),8&e.$$.dirty&&u(s,"maxvisible",m.number().integer()),10&e.$$.dirty&&i(7,o=s<n?.length)},[r,n,l,s,a,c,d,o,function(e){dispatchContentDisplayEvent({node:a,item:e})},p,function(){clearTimeout(g.confirmTimeoutId),i(6,d=!0),g.confirmTimeoutId=setTimeout((()=>{i(6,d=!1)}),3e3),c&&p()},function(){a?.parentNode.host.dispatchEvent(new window.CustomEvent("expand",{bubbles:!1}))},function(){a?.parentNode.host.dispatchEvent(new window.CustomEvent("edit",{bubbles:!1}))},function(e){e.stopPropagation(),a?.parentNode.host.dispatchEvent(new window.CustomEvent("remove",{bubbles:!1}))},function(e){e.stopPropagation(),clearTimeout(g.confirmTimeoutId),i(6,d=!1)},function(){a?.scrollTo({top:0,left:0})},function(e){binding_callbacks[e?"unshift":"push"]((()=>{a=e,i(4,a)}))}]}class Widget extends SvelteElement{constructor(e){super();const t=document.createElement("style");t.textContent="html{--eggshell:235,235,235;--purple:40,16,98;--mauve:154,88,133;--pinkred:255,85,112;--red:255, 0, 0;--gold:187,183,76;--silvergold:237,233,126;--sky:88,146,246;--deepsky:20,48,151;--space:34,32,56;--deepspace:6,3,33;--grass:0,238,119;--transluent:rgba(255,255,255,0.12);--deepwater:51,50,77}html,:host{--anim-duration:0.25s}:where(.animated){transition-duration:var(--anim-duration);transition-timing-function:ease-in-out;transition-property:color, background-color, opacity, visibility, height, width, transform, \n    transform-origin, filter, left, top, right, no-prop}@media(hover: hover){.hover-fx:not([disabled]):hover{opacity:0.75}}.not-visible{visibility:hidden;opacity:0}.visible{visibility:visible;opacity:1}:host{--border-radius:0.391em;display:inline-block;border-radius:var(--border-radius);box-shadow:0 0 1px 0 rgb(235,235,235);box-shadow:0 0 1px 0 rgb(var(--eggshell));background-color:rgba(255,255,255,0.12);background-color:var(--transluent)}ul{--gap:0.14em;list-style:none;display:flex;flex-direction:column;grid-gap:var(--gap);gap:var(--gap);padding:0;margin:0;border-radius:var(--border-radius);overflow:hidden;isolation:isolate;scroll-snap-type:y mandatory;scroll-padding:calc(2 * var(--gap)) 0;-webkit-user-select:none;-moz-user-select:none;user-select:none\n  }ul.animated{transition-property:box-shadow, scale}ul.overflowed{--item-height:2.25em;--header-height:2.625em;--max-height:calc(var(--header-height) + var(--max-visible) * (var(--item-height) + var(--gap)) - var(--gap));overflow:auto;overscroll-behavior:none;max-height:var(--max-height)}ul.marked-for-control{box-shadow:0 0 0 0.1em rgb(235,235,235);box-shadow:0 0 0 0.1em rgb(var(--eggshell));scale:1.06}li{scroll-snap-align:start\n  }li:not(:first-child):nth-child(2n + 1){background-color:rgba(235,235,235, 25%);background-color:rgba(var(--eggshell), 25%)}li:first-child{--background-color:color-mix(in srgb, rgba(var(--gold), 90%), white 12.5%);padding:0.556em 1em;background-image:linear-gradient(var(--background-color), rgba(187,183,76, 75%));background-image:linear-gradient(var(--background-color), rgba(var(--gold), 75%));color:rgb(40,16,98);color:rgb(var(--purple));position:sticky;box-sizing:border-box;top:0;z-index:1\n    }li:first-child::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;box-shadow:inset 0 0 1px 0 white;border-radius:var(--border-radius) var(--border-radius) 0 0}.overflowed li:first-child::after{--scrollbar-thumb-background-color-components:0,0,0;--scrollbar-thumb-border-color-components:255,255,255;content:'';position:absolute;top:calc(var(--header-height) + 0.5 * (var(--max-height) - var(--header-height)));transform:translateY(-50%);right:1.5px;width:6px;height:calc(0.4 * var(--max-height));background-color:rgba(var(--scrollbar-thumb-background-color-components), 50%);border:solid 1px rgba(var(--scrollbar-thumb-border-color-components), 33%);border-radius:6px;transition-duration:var(--anim-duration);transition-timing-function:ease-in-out;transition-property:color, background-color, opacity, visibility, height, width, transform, \n    transform-origin, filter, left, top, right, no-prop\n    }@supports (-moz-appearance: none){.overflowed li:first-child::after{--scrollbar-thumb-background-color-components:255,255,255;--scrollbar-thumb-border-color-components:0,0,0\n    }}.overflowed:hover li:first-child::after{visibility:hidden;opacity:0\n    }h2{letter-spacing:0.075em;margin:0;line-height:1;white-space:pre;display:flex;font-feature-settings:\"smcp\";font-variant-caps:small-caps\n  }h2>span{overflow:hidden;text-overflow:ellipsis;width:100%;display:inline-block\n    }h2>span::first-letter{text-transform:uppercase}a,button{color:currentColor}a{text-decoration:none}.controls{--right-margin:0.6em;--column-gap:calc(2 * var(--right-margin));position:absolute;display:flex;top:50%;translate:0 -50%;right:var(--right-margin);grid-column-gap:var(--column-gap);-moz-column-gap:var(--column-gap);column-gap:var(--column-gap)\n  }.controls button{position:relative\n    }.controls button::before{content:'';position:absolute;width:100%;aspect-ratio:1;top:calc(-1 * var(--right-margin));left:calc(-1 * var(--right-margin));border-radius:50%;border:solid var(--right-margin) transparent}@media(hover: hover){:host(:hover) :where(.controls > *){visibility:visible;opacity:1\n    }}button{cursor:pointer;padding:0;border:none;width:100%;font-family:inherit;font-size:inherit;background-color:transparent}.delete,.edit,.confirm,.abort,.expand{width:1.5em;aspect-ratio:1}.delete{background-color:rgb(255, 0, 0);background-color:rgb(var(--red));border-radius:50%;font-weight:bold;display:flex;justify-content:center;align-items:center;color:rgb(235,235,235);color:rgb(var(--eggshell));position:relative\n  }.delete::after{content:'';height:0.1875em;width:65%;background-color:currentColor}.confirmPanel{--background-color:rgb(var(--deepwater));position:absolute;top:50%;left:0;translate:calc(-100% - var(--column-gap)) -50%;display:flex;grid-column-gap:var(--column-gap);-moz-column-gap:var(--column-gap);column-gap:var(--column-gap);background-color:var(--background-color);box-shadow:0 0 0 0.21em var(--background-color);border-radius:0.75em}.confirm,.abort{--background-shift:0.125em;background-repeat:no-repeat;background-size:75%}.confirm{background-image:url(https://janouma.github.io/heimdall-layouts/layouts/dashboard/widget/assets/images/yes.svg);background-position:center top var(--background-shift)}.abort{background-image:url(https://janouma.github.io/heimdall-layouts/layouts/dashboard/widget/assets/images/no.svg);background-position:center bottom var(--background-shift)}.edit{background:no-repeat center/100%;background-image:url(https://janouma.github.io/heimdall-layouts/layouts/dashboard/widget/assets/images/pencil.svg);transition-delay:0.1s}.expand{background:no-repeat center/75%;background-image:url(https://janouma.github.io/heimdall-layouts/layouts/dashboard/widget/assets/images/expand.svg);box-sizing:border-box;border:0.1em solid rgb(235,235,235);border:0.1em solid rgb(var(--eggshell));border-radius:15%;transition-delay:0.2s}",this.shadowRoot.appendChild(t),init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance,create_fragment,not_equal,{title:0,items:1,messages:2,maxvisible:3,scrollToTop:15},null),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["title","items","messages","maxvisible","scrollToTop"]}get title(){return this.$$.ctx[0]}set title(e){this.$$set({title:e}),flush()}get items(){return this.$$.ctx[1]}set items(e){this.$$set({items:e}),flush()}get messages(){return this.$$.ctx[2]}set messages(e){this.$$set({messages:e}),flush()}get maxvisible(){return this.$$.ctx[3]}set maxvisible(e){this.$$set({maxvisible:e}),flush()}get scrollToTop(){return this.$$.ctx[15]}}customElements.define("hdl-dashboard-widget",Widget);export default Widget;