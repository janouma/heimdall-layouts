import{SvelteElement,action_destroyer,append,assign,attr,attribute_to_object,binding_callbacks,destroy_each,detach,element,empty,flush,get_spread_update,init,insert,is_function,listen,noop,not_equal,set_attributes,set_custom_element_data,set_custom_element_data_map,set_data,set_style,space,text,toggle_class}from"/heimdall-layouts/layouts/dashboard/../../packages/svelte/internal/index.mjs";import"/heimdall-layouts/layouts/dashboard/../../packages/joi-browser.min.js";import"/heimdall-layouts/layouts/dashboard/item/index.js";import{createValidator}from"/heimdall-layouts/layouts/dashboard/../../lib/validation.js";import{onLongTouch}from"/heimdall-layouts/layouts/dashboard/../../lib/events.js";function get_each_context(e,t,i){const a=e.slice();return a[16]=t[i],a}function create_if_block_1(e){let t,i,a,o;return{c(){t=element("button"),attr(t,"title",i=e[2]?.deletetitle),attr(t,"class","delete animated hover-fx not-visible"),toggle_class(t,"visible",e[5])},m(i,n){insert(i,t,n),a||(o=listen(t,"click",e[10]),a=!0)},p(e,a){4&a&&i!==(i=e[2]?.deletetitle)&&attr(t,"title",i),32&a&&toggle_class(t,"visible",e[5])},d(e){e&&detach(t),a=!1,o()}}}function create_if_block(e){let t,i=e[1],a=[];for(let t=0;t<i.length;t+=1)a[t]=create_each_block(get_each_context(e,i,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=empty()},m(e,i){for(let t=0;t<a.length;t+=1)a[t].m(e,i);insert(e,t,i)},p(e,o){if(262&o){let n;for(i=e[1],n=0;n<i.length;n+=1){const r=get_each_context(e,i,n);a[n]?a[n].p(r,o):(a[n]=create_each_block(r),a[n].c(),a[n].m(t.parentNode,t))}for(;n<a.length;n+=1)a[n].d(1);a.length=i.length}},d(e){destroy_each(a,e),e&&detach(t)}}}function create_dynamic_element(e){let t,i,a,o,n,r,s,l,c,d,m=[{href:l=isLink(e[16])?e[16].url:void 0},{rel:"noopener"},{target:"_blank"}],h={};for(let e=0;e<m.length;e+=1)h=assign(h,m[e]);return{c(){t=element(getActionTag(e[16])),i=element("hdl-dashboard-item"),set_custom_element_data(i,"title",a=e[16].title),set_custom_element_data(i,"snapshot",o=e[16].snapshot),set_custom_element_data(i,"icon",n=e[16].icon),set_custom_element_data(i,"iconalt",r=e[2]?.iconalt),set_custom_element_data(i,"type",s=e[16].type),/-/.test(getActionTag(e[16]))?set_custom_element_data_map(t,h):set_attributes(t,h)},m(a,o){insert(a,t,o),append(t,i),c||(d=listen(t,"click",(function(){is_function(isLink(e[16])?void 0:e[8](e[16]))&&(isLink(e[16])?void 0:e[8](e[16])).apply(this,arguments)})),c=!0)},p(c,d){e=c,2&d&&a!==(a=e[16].title)&&set_custom_element_data(i,"title",a),2&d&&o!==(o=e[16].snapshot)&&set_custom_element_data(i,"snapshot",o),2&d&&n!==(n=e[16].icon)&&set_custom_element_data(i,"icon",n),4&d&&r!==(r=e[2]?.iconalt)&&set_custom_element_data(i,"iconalt",r),2&d&&s!==(s=e[16].type)&&set_custom_element_data(i,"type",s),h=get_spread_update(m,[2&d&&l!==(l=isLink(e[16])?e[16].url:void 0)&&{href:l},{rel:"noopener"},{target:"_blank"}]),/-/.test(getActionTag(e[16]))?set_custom_element_data_map(t,h):set_attributes(t,h)},d(e){e&&detach(t),c=!1,d()}}}function create_each_block(e){let t,i,a=getActionTag(e[16]),o=getActionTag(e[16])&&create_dynamic_element(e);return{c(){t=element("li"),o&&o.c(),i=space(),attr(t,"class","animated hover-fx")},m(e,a){insert(e,t,a),o&&o.m(t,null),append(t,i)},p(e,n){getActionTag(e[16])?a?not_equal(a,getActionTag(e[16]))?(o.d(1),o=create_dynamic_element(e),o.c(),o.m(t,i)):o.p(e,n):(o=create_dynamic_element(e),o.c(),o.m(t,i)):a&&(o.d(1),o=null),a=getActionTag(e[16])},d(e){e&&detach(t),o&&o.d(e)}}}function create_fragment(e){let t,i,a,o,n,r,s,l,c,d=e[6]&&create_if_block_1(e),m=e[1]?.length>0&&create_if_block(e);return{c(){t=element("ul"),i=element("li"),a=element("h2"),o=text(e[0]),n=space(),d&&d.c(),r=space(),m&&m.c(),this.c=noop,attr(t,"class","animated"),toggle_class(t,"overflowed",e[7]),toggle_class(t,"marked-for-delete",e[6]&&e[5]),set_style(t,"--max-visible",e[3])},m(h,u){insert(h,t,u),append(t,i),append(i,a),append(a,o),append(a,n),d&&d.m(a,null),append(t,r),m&&m.m(t,null),e[12](t),l||(c=action_destroyer(s=onLongTouch.call(null,t,e[6]&&e[9])),l=!0)},p(e,[i]){1&i&&set_data(o,e[0]),e[6]?d?d.p(e,i):(d=create_if_block_1(e),d.c(),d.m(a,null)):d&&(d.d(1),d=null),e[1]?.length>0?m?m.p(e,i):(m=create_if_block(e),m.c(),m.m(t,null)):m&&(m.d(1),m=null),s&&is_function(s.update)&&64&i&&s.update.call(null,e[6]&&e[9]),128&i&&toggle_class(t,"overflowed",e[7]),96&i&&toggle_class(t,"marked-for-delete",e[6]&&e[5]),8&i&&set_style(t,"--max-visible",e[3])},i:noop,o:noop,d(i){i&&detach(t),d&&d.d(),m&&m.d(),e[12](null),l=!1,c()}}}function getActionTag(e){return isLink(e)?"a":"button"}function isLink(e){return!e.type||"url"===e.type}function instance(e,t,i){let a,o,n,{title:r}=t,{items:s}=t,{messages:l}=t,{maxVisible:c}=t,{readonly:d}=t,m=!1;const h={timeoutId:void 0},{joi:u}=window,g=createValidator("dashboard/widget");return e.$$set=e=>{"title"in e&&i(0,r=e.title),"items"in e&&i(1,s=e.items),"messages"in e&&i(2,l=e.messages),"maxVisible"in e&&i(3,c=e.maxVisible),"readonly"in e&&i(11,d=e.readonly)},e.$$.update=()=>{1&e.$$.dirty&&g(r,"title",u.string()),2&e.$$.dirty&&g(s,"items",u.array().items(u.object({$id:u.string().required(),title:u.string().required(),url:u.string(),snapshot:u.alternatives().try(u.string(),null),icon:u.alternatives().try(u.string(),null),type:u.string().valid("url","text","javascript","css","html","shell","python","json")}).unknown().required()).min(1)),4&e.$$.dirty&&g(l,"messages",u.object({iconalt:u.string().required(),deletetitle:u.string().required()})),8&e.$$.dirty&&g(c,"maxVisible",u.number().integer()),10&e.$$.dirty&&i(7,a=c<s?.length),2048&e.$$.dirty&&i(6,o=null==d)},[r,s,l,c,n,m,o,a,function(e){n?.parentNode.host.dispatchEvent(new window.CustomEvent("show-item-content",{detail:e,bubbles:!1}))},function(){clearTimeout(h.timeoutId),i(5,m=!0),setTimeout((()=>{i(5,m=!1)}),3e3)},function(){n?.parentNode.host.dispatchEvent(new window.CustomEvent("remove"))},d,function(e){binding_callbacks[e?"unshift":"push"]((()=>{n=e,i(4,n)}))}]}class Widget extends SvelteElement{constructor(e){super(),this.shadowRoot.innerHTML="<style>html,:host{--anim-duration:0.25s}.animated{transition-duration:var(--anim-duration);transition-timing-function:ease-in-out;transition-property:color, background-color, opacity,\n    visibility, height, width, transform, transform-origin, filter, left, top, right}@media(hover: hover){.hover-fx:not([disabled]):hover{opacity:0.75}}.not-visible{visibility:hidden;opacity:0}.visible{visibility:visible;opacity:1}:host{display:inline-block}ul{--gap:0.14em;--border-radius:0.391em;list-style:none;display:flex;flex-direction:column;grid-gap:var(--gap);gap:var(--gap);padding:0;margin:0;border-radius:var(--border-radius);overflow:hidden;isolation:isolate;scroll-snap-type:y mandatory;scroll-padding:calc(2 * var(--gap)) 0;-webkit-user-select:none;-moz-user-select:none;user-select:none\n  }ul.animated{transition-property:box-shadow, scale}ul.overflowed{--item-height:2.25em;--header-height:2.625em;--max-height:calc(var(--header-height) + var(--max-visible) * (var(--item-height) + var(--gap)) - var(--gap));overflow:auto;overscroll-behavior:contain;max-height:var(--max-height)}ul.marked-for-delete{box-shadow:0 0 0 0.5em rgb(var(--pinkred));scale:1.06}li{scroll-snap-align:start\n  }li:first-child{padding:0.556em 0.65em;background-color:rgba(var(--deepwater), 75%);position:sticky;box-sizing:border-box;top:0;z-index:1\n    }li:first-child::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;box-shadow:inset 0 0 1px 0 white;border-radius:var(--border-radius) var(--border-radius) 0 0}.overflowed li:first-child::after{--scrollbar-thumb-background-color-components:0,0,0;--scrollbar-thumb-border-color-components:255,255,255;content:'';position:absolute;top:calc(var(--header-height) + 0.5 * (var(--max-height) - var(--header-height)));transform:translateY(-50%);right:1.5px;width:6px;height:calc(0.4 * var(--max-height));background-color:rgba(var(--scrollbar-thumb-background-color-components), 50%);border:solid 1px rgba(var(--scrollbar-thumb-border-color-components), 33%);border-radius:6px;transition-duration:var(--anim-duration);transition-timing-function:ease-in-out;transition-property:color, background-color, opacity,\n    visibility, height, width, transform, transform-origin, filter, left, top, right\n    }@supports (-moz-appearance: none){.overflowed li:first-child::after{--scrollbar-thumb-background-color-components:255,255,255;--scrollbar-thumb-border-color-components:0,0,0\n    }}.overflowed:hover li:first-child::after{visibility:hidden;opacity:0\n    }h2{text-transform:capitalize;margin:0;line-height:1;white-space:pre;overflow:hidden;text-overflow:ellipsis}a,button{color:currentColor}a{text-decoration:none}button{cursor:pointer;padding:0;width:100%;border:none;font-family:inherit;font-size:inherit}.delete{position:absolute;top:50%;transform:translateY(-50%);right:0.4em;width:1em;aspect-ratio:1;background-color:rgb(var(--red));border:1px solid rgb(var(--eggshell));border-radius:50%;font-weight:bold;display:flex;justify-content:center;align-items:center\n  }.delete::before{--expanse:50%;content:'';position:absolute;width:100%;aspect-ratio:1;top:0;left:0;border-radius:50%;margin:calc(-1 * var(--expanse));padding:var(--expanse)}.delete::after{content:'';height:0.125em;width:65%;background-color:currentColor}@media(hover: hover){:host(:hover) :where(.delete){visibility:visible;opacity:1\n  }}</style>",init(this,{target:this.shadowRoot,props:attribute_to_object(this.attributes),customElement:!0},instance,create_fragment,not_equal,{title:0,items:1,messages:2,maxVisible:3,readonly:11},null),e&&(e.target&&insert(e.target,this,e.anchor),e.props&&(this.$set(e.props),flush()))}static get observedAttributes(){return["title","items","messages","maxVisible","readonly"]}get title(){return this.$$.ctx[0]}set title(e){this.$$set({title:e}),flush()}get items(){return this.$$.ctx[1]}set items(e){this.$$set({items:e}),flush()}get messages(){return this.$$.ctx[2]}set messages(e){this.$$set({messages:e}),flush()}get maxVisible(){return this.$$.ctx[3]}set maxVisible(e){this.$$set({maxVisible:e}),flush()}get readonly(){return this.$$.ctx[11]}set readonly(e){this.$$set({readonly:e}),flush()}}customElements.define("hdl-dashboard-widget",Widget);export default Widget;